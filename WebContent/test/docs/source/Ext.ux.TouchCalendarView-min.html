<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">Ext.define(&quot;Ext.ux.TouchCalendarView&quot;,{extend:&quot;Ext.Container&quot;,alias:&quot;widget.touchcalendarview&quot;,config:{viewMode:&quot;month&quot;,weekStart:1,todayCls:&quot;today&quot;,selectedItemCls:&quot;selected&quot;,unselectableCls:&quot;unselectable&quot;,prevMonthCls:&quot;prev-month&quot;,nextMonthCls:&quot;next-month&quot;,weekendCls:&quot;weekend&quot;,prevPeriodCls:&quot;goto-prev&quot;,nextPeriodCls:&quot;goto-next&quot;,dayTimeSlotSize:30,timeSlotDateTpls:{},hideHalfHourTimeSlotLabels:true,value:null,store:null,baseTpl:['&lt;table class=&quot;{[this.me.getViewMode().toLowerCase()]}&quot;&gt;',&quot;&lt;thead&gt;&quot;,&quot;&lt;tr&gt;&quot;,'&lt;tpl for=&quot;this.getDaysArray(values)&quot;&gt;','&lt;th class=&quot;{[this.getHeaderClass(xindex)]}&quot;&gt;','&lt;tpl if=&quot;xindex === 4&quot;&gt;','&lt;span&gt;{[Ext.Date.format(this.me.currentDate, &quot;F&quot;)]} {[Ext.Date.format(this.me.currentDate, &quot;Y&quot;)]}&lt;/span&gt;',&quot;&lt;/tpl&gt;&quot;,'{date:date(&quot;D&quot;)}',&quot;&lt;/th&gt;&quot;,&quot;&lt;/tpl&gt;&quot;,&quot;&lt;/tr&gt;&quot;,&quot;&lt;/thead&gt;&quot;,&quot;&lt;tbody&gt;&quot;,'&lt;tr class=&quot;time-block-row&quot;&gt;','&lt;tpl for=&quot;.&quot;&gt;','&lt;td class=&quot;time-block {[this.getClasses(values)]}&quot; datetime=&quot;{[this.me.getDateAttribute(values.date)]}&quot;&gt;',&quot;{date:this.formatDate()}&quot;,&quot;&lt;/td&gt;&quot;,'&lt;tpl if=&quot;this.isEndOfRow(xindex)&quot;&gt;',&quot;&lt;/tr&gt;&quot;,'&lt;tpl if=&quot;!this.isEndOfPeriod(xindex)&quot;&gt;',&quot;&lt;tr&gt;&quot;,&quot;&lt;/tpl&gt;&quot;,&quot;&lt;/tpl&gt;&quot;,&quot;&lt;/tpl&gt;&quot;,&quot;&lt;/tr&gt;&quot;,&quot;&lt;/tbody&gt;&quot;,&quot;&lt;/table&gt;&quot;],cls:&quot;touch-calendar-view&quot;,itemSelector:&quot;td.time-block&quot;},timeSlotDateTplsDefaults:{day:'&lt;span class=&quot;hour&quot;&gt;{date:date(&quot;g&quot;)}&lt;/span&gt;&lt;span class=&quot;am-pm&quot;&gt;{date:date(&quot;A&quot;)}&lt;/span&gt;',month:'{date:date(&quot;j&quot;)}',week:'{date:date(&quot;j&quot;)}'},commonTemplateFunctions:{getTimeSlotRowCls:function(b){var c=[],a=b.getMinutes()!==0;if(a){c.push(&quot;half-hour&quot;)}return c.join(&quot; &quot;)},isHalfHour:function(a){return a.getMinutes()!==0},formatDate:function(a){return this.getTimeSlotDateTpl().apply({date:a})},getTimeSlotDateTpl:function(){var a=this.me.getViewMode().toLowerCase();return this.me.getTimeSlotDateTpls()[a]},getClasses:function(a){var b=[];if(a.selected){b.push(this.me.getSelectedItemCls())}if(a.unselectable){b.push(this.me.getUnselectableCls())}if(a.prevMonth){b.push(this.me.getPrevMonthCls())}if(a.nextMonth){b.push(this.me.getNextMonthCls())}if(a.weekend){b.push(this.me.getWeekendCls())}if(a.today){b.push(this.me.getTodayCls())}return b.join(&quot; &quot;)},isEndOfRow:function(a){return(a%7)===0&amp;&amp;(a&gt;0)},isStartOfRow:function(a){return((a-1)%7)===0&amp;&amp;(a-1&gt;=0)},isEndOfPeriod:function(a){return a%this.me.periodRowDayCount===0},getDaysArray:function(a){var c=[],b;for(b=0;b&lt;this.me.periodRowDayCount;b++){c.push(a[b])}return c},getHeaderClass:function(a){return a===1?this.me.getPrevPeriodCls():a===7?this.me.getNextPeriodCls():&quot;&quot;}},constructor:function(b){this.initModel();var a=Ext.create(&quot;Ext.data.Store&quot;,{model:&quot;TouchCalendarViewModel&quot;});this.setStore(a);b.timeSlotDateTpls=b.timeSlotDateTpls||{};Ext.applyIf(b.timeSlotDateTpls,this.timeSlotDateTplsDefaults);Ext.apply(this,b||{});this.callParent(arguments);this.minDate=this.minDate?Ext.Date.clearTime(this.minDate,true):null;this.maxDate=this.maxDate?Ext.Date.clearTime(this.maxDate,true):null;this.refresh()},initialize:function(){this.element.on({tap:this.onTableHeaderTap,scope:this,delegate:&quot;th&quot;});this.element.on({tap:this.onTimeSlotTap,scope:this,delegate:this.getItemSelector()});this.on({painted:this.syncHeight,resize:this.onComponentResize,scope:this});this.callParent()},initModel:function(){if(!Ext.ModelManager.isRegistered(&quot;TouchCalendarViewModel&quot;)){Ext.define(&quot;TouchCalendarViewModel&quot;,{extend:&quot;Ext.data.Model&quot;,config:{fields:[{name:&quot;date&quot;,type:&quot;date&quot;},{name:&quot;today&quot;,type:&quot;boolean&quot;},{name:&quot;unselectable&quot;,type:&quot;boolean&quot;},{name:&quot;selected&quot;,type:&quot;boolean&quot;},{name:&quot;prevMonth&quot;,type:&quot;boolean&quot;},{name:&quot;nextMonth&quot;,type:&quot;boolean&quot;},{name:&quot;weekend&quot;,type:&quot;boolean&quot;},&quot;timeSlots&quot;]}})}},updateViewMode:function(a,c){this.refresh();var b=this.getPeriodMinMaxDate();this.fireEvent(&quot;periodchange&quot;,this,b.min.get(&quot;date&quot;),b.max.get(&quot;date&quot;),&quot;none&quot;)},applyViewMode:function(b){b=b.toUpperCase();var a=Ext.ux.TouchCalendarView[b.toUpperCase()];this.getStartDate=a.getStartDate;this.getTotalDays=a.getTotalDays;this.dateAttributeFormat=a.dateAttributeFormat;this.getNextIterationDate=a.getNextIterationDate;this.getDeltaDate=a.getDeltaDate;this.periodRowDayCount=a.periodRowDayCount;Ext.apply(this.commonTemplateFunctions,{me:this});this.setTpl(new Ext.XTemplate((a.tpl||this.getBaseTpl()).join(&quot;&quot;),this.commonTemplateFunctions));this.setScrollable({direction:b.toUpperCase()===&quot;DAY&quot;?&quot;vertical&quot;:false,directionLock:true});return b},collectData:function(a){var b=[];Ext.each(a,function(c,d){b.push(c.data)},this);return b},populateStore:function(){this.currentDate=this.currentDate||this.value||new Date();var d=true,e=this.currentDate,c=this.getStartDate(e),f=this.getTotalDays(e),a;this.getStore().suspendEvents();this.getStore().data.clear();for(var b=0;b&lt;f;b++){c=this.getNextIterationDate(c,(b===0?0:1));d=(this.minDate&amp;&amp;c&lt;this.minDate)||(this.maxDate&amp;&amp;c&gt;this.maxDate);a=Ext.create(&quot;TouchCalendarViewModel&quot;,{today:this.isSameDay(c,new Date()),unselectable:d,selected:this.isSameDay(c,this.value)&amp;&amp;!d,prevMonth:(c.getMonth()&lt;e.getMonth()),nextMonth:(c.getMonth()&gt;e.getMonth()),weekend:this.isWeekend(c),date:c});this.getStore().add(a)}this.getStore().resumeEvents()},refreshDelta:function(d){var b=this.currentDate||new Date();var a=this.getDeltaDate(b,d);if(this.isOutsideMinMax(a)){return}this.currentDate=a;this.refresh();var c=this.getPeriodMinMaxDate();this.fireEvent(&quot;periodchange&quot;,this,c.min.get(&quot;date&quot;),c.max.get(&quot;date&quot;),(d&gt;0?&quot;forward&quot;:&quot;back&quot;))},getPeriodMinMaxDate:function(){return{min:this.getStore().data.first(),max:this.getStore().data.last()}},isOutsideMinMax:function(a){var b=false;if(this.getViewMode()===&quot;MONTH&quot;){b=((this.minDate&amp;&amp;Ext.Date.getLastDateOfMonth(a)&lt;this.minDate)||(this.maxDate&amp;&amp;Ext.Date.getFirstDateOfMonth(a)&gt;this.maxDate))}else{b=((this.minDate&amp;&amp;this.getWeekendDate(a)&lt;this.minDate)||(this.maxDate&amp;&amp;this.getStartDate(a)&gt;this.maxDate))}return b},onTableHeaderTap:function(b,a){a=Ext.fly(a);if(a.hasCls(this.getPrevPeriodCls())||a.hasCls(this.getNextPeriodCls())){this.refreshDelta(a.hasCls(this.getPrevPeriodCls())?-1:1)}},onTimeSlotTap:function(d){if(!d.getTarget(&quot;.&quot;+this.getUnselectableCls())){var c=Ext.fly(d.getTarget());this.selectCell(c);var b=this.getCellDate(c);var a=this.getValue()||this.currentDate;if(b.getTime()!==a.getTime()){this.setValue(b);this.fireEvent(&quot;selectionchange&quot;,this,b,a)}}},onComponentResize:function(a){this.syncHeight()},refresh:function(){this.populateStore();var a=this.getStore().getRange();this.setData(this.collectData(a));this.syncHeight()},syncHeight:function(){if(this.getViewMode().toUpperCase()!==&quot;DAY&quot;){var a=this.element.select(&quot;table&quot;,this.element.dom).first();if(a){a.setHeight(this.element.getHeight())}}},selectCell:function(a){var b=this.getSelectedItemCls();var c=this.element.select(&quot;.&quot;+b,this.element.dom);if(c){c.removeCls(b)}a.addCls(b);a.up(&quot;tr&quot;).addCls(b)},getDateRecord:function(a){return this.getStore().findBy(function(b){var c=Ext.Date.clearTime(b.get(&quot;date&quot;),true).getTime();return c===Ext.Date.clearTime(a,true).getTime()},this)},getDayStartDate:function(a){return a},isSameDay:function(b,a){if(!b||!a){return false}return Ext.Date.clearTime(b,true).getTime()===Ext.Date.clearTime(a,true).getTime()},isWeekend:function(a){return a.getDay()===0||a.getDay()===6},getWeekendDate:function(b){var a=b.getDay()-this.getWeekStart();a=a&lt;0?6:a;return new Date(b.getFullYear(),b.getMonth(),b.getDate()+0+a)},getCellDate:function(b){var a=b.dom.getAttribute(&quot;datetime&quot;);return this.stringToDate(a)},getDateCell:function(a){return this.element.select('td[datetime=&quot;'+this.getDateAttribute(a)+'&quot;]',this.element.dom).first()},getDateAttribute:function(a){return Ext.Date.format(a,this.dateAttributeFormat)},getSelected:function(){var a=this.element.select(&quot;td.&quot;+this.getSelectedItemCls(),this.element.dom),b=[];a.each(function(c){b.push(this.getCellDate(c))},this);return b},stringToDate:function(a){return Ext.Date.parseDate(a,this.dateAttributeFormat)},applyTimeSlotDateTpls:function(a){Ext.Object.each(a,function(b,c){if(Ext.isString){a[b]=Ext.create(&quot;Ext.XTemplate&quot;,c)}},this);return a},statics:{MONTH:{dateAttributeFormat:&quot;d-m-Y&quot;,getNextIterationDate:function(b,a){return new Date(b.getFullYear(),b.getMonth(),b.getDate()+(a===0?0:1))},getTotalDays:function(a){var b=Ext.Date.getFirstDateOfMonth(a);return this.isWeekend(b)?42:35},getStartDate:function(a){return Ext.bind(Ext.ux.TouchCalendarView.WEEK.getStartDate,this)(new Date(a.getFullYear(),a.getMonth(),1))},getDeltaDate:function(b,d){var c=b.getMonth()+d,a=new Date(b.getFullYear(),c,1);a.setDate(Ext.Date.getDaysInMonth(a)&lt;b.getDate()?Ext.Date.getDaysInMonth(a):b.getDate());return a},periodRowDayCount:7},WEEK:{dateAttributeFormat:&quot;d-m-Y&quot;,getNextIterationDate:function(b,a){return new Date(b.getFullYear(),b.getMonth(),b.getDate()+(a===0?0:1))},getTotalDays:function(a){return 7},getStartDate:function(b){var a=b.getDay()-this.getWeekStart();a=a&lt;0?6:a;return new Date(b.getFullYear(),b.getMonth(),b.getDate()-0-a)},getDeltaDate:function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate()+(b*7))},periodRowDayCount:7},DAY:{dateAttributeFormat:&quot;d-m-Y H:i&quot;,tpl:['&lt;table class=&quot;{[this.me.getViewMode().toLowerCase()]}&quot;&gt;',&quot;&lt;thead&gt;&quot;,&quot;&lt;tr&gt;&quot;,'&lt;th class=&quot;{[this.me.getPrevPeriodCls()]} style=&quot;display: block;&quot;&gt;',&quot;&lt;/th&gt;&quot;,&quot;&lt;th&gt;&quot;,'&lt;span&gt;{[Ext.Date.format(values[0].date, &quot;D jS M Y&quot;)]}&lt;/span&gt;',&quot;&lt;/th&gt;&quot;,'&lt;th class=&quot;{[this.me.getNextPeriodCls()]} style=&quot;display: block;&quot;&quot;&gt;',&quot;&lt;/th&gt;&quot;,&quot;&lt;/tr&gt;&quot;,&quot;&lt;/thead&gt;&quot;,&quot;&lt;tbody&gt;&quot;,&quot;&lt;tr&gt;&quot;,'&lt;td colspan=&quot;3&quot;&gt;','&lt;table class=&quot;time-slot-table&quot;&gt;','&lt;tpl for=&quot;.&quot;&gt;','&lt;tr class=&quot;{[this.getTimeSlotRowCls(values.date)]}&quot;&gt;','&lt;td class=&quot;label&quot;&gt;','&lt;tpl if=&quot;!this.me.getHideHalfHourTimeSlotLabels() || !this.isHalfHour(values.date)&quot;&gt;',&quot;{date:this.formatDate()}&quot;,&quot;&lt;/tpl&gt;&quot;,&quot;&lt;/td&gt;&quot;,'&lt;td class=&quot;time-block&quot; colspan=&quot;2&quot; datetime=&quot;{[this.me.getDateAttribute(values.date)]}&quot;&gt;',&quot;&lt;/td&gt;&quot;,&quot;&lt;/tr&gt;&quot;,&quot;&lt;/tpl&gt;&quot;,&quot;&lt;/table&gt;&quot;,&quot;&lt;/td&gt;&quot;,&quot;&lt;/tr&gt;&quot;,&quot;&lt;/tbody&gt;&quot;,&quot;&lt;/table&gt;&quot;],getNextIterationDate:function(b,a){var c=b.getTime()+((a===0?0:1)*(this.getDayTimeSlotSize()*60*1000));return new Date(c)},getTotalDays:function(a){return 1440/this.getDayTimeSlotSize()},getStartDate:function(a){return Ext.Date.clearTime(a,true)},getDeltaDate:function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate()+b)},periodRowDayCount:1}}});</pre>
</body>
</html>
